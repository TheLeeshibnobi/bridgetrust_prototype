{% extends "base.html" %}

{% block content %}
<style>
    body {
    background-color: white;
  }

  .card {
  height: 420px;
  margin-bottom: 1rem;
  display: flex;
  flex-direction: column;
}

  .card-body {
  overflow: visible !important;
}

  .card-body p {
    margin-bottom: 0.5rem;
  }
  .table-container {
    margin-top: 2rem;
  }
  .table-container h3 {
    font-size: 1.3rem;
    margin-bottom: 1rem;
  }
  .table {
    font-size: 0.85rem;
    border-collapse: collapse;
    width: 100%;
  }
  .table th,
  .table td {
    padding: 0.5rem;
    vertical-align: middle;
    border-left: none;
    border-right: none;
    border-top: none;
    border-bottom: 1px solid #dee2e6; /* Keep only horizontal lines */
  }
  .table th {
    background-color: #e6f2ff; /* Light blue header */
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
  }

  .loan-section-title {
      background-color: #f0f8ff; /* faded blue */
      padding: 10px 15px;
      border-bottom: 3px solid red;
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
    }

  /* Make the table container more compact */
  .table-responsive {
    max-height: 400px;
    overflow-y: auto;
  }
</style>

<div class="container">
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% elif not loan %}
    <div class="alert alert-info">No loan data available</div>
  {% else %}
    <h2 class="loan-section-title">
      Loan Information - {{ loan.personal_information.first_name }} {{ loan.personal_information.last_name }}
    </h2>


    <div class="row">
      <div class="col-md-4">
        <div class="card">
          <div class="card-header">Personal Information</div>
          <div class="card-body">
            <p><strong>Full Names:</strong> {{ loan.personal_information.first_name }} {{ loan.personal_information.last_name }}</p>
            <p><strong>Email Address:</strong> {{ loan.personal_information.email }}</p>
            <p><strong>Phone Number:</strong> {{ loan.personal_information.phone }}</p>
            <p><strong>NRC/Passport:</strong> {{ loan.personal_information.nrc_number }}</p>
            <p><strong>Place of work:</strong> {{ loan.personal_information.occupation }}</p>
            <p><strong>Date of Birth:</strong> {{ loan.personal_information.date_of_birth }}</p>
            <p><strong>Address:</strong> {{ loan.personal_information.address }}</p>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-header">Loan Details</div>
          <div class="card-body">
            <p><strong>Loan Status:</strong> <span class="badge badge-primary">{{ loan.loan_information.status|title }}</span></p>
            <p><strong>Ref No:</strong> {{ loan.loan_information.id[:8] }}</p>
            <p><strong>Loan Principal:</strong> K{{ "{:,.0f}".format(loan.loan_information.principal) }}</p>
            <p><strong>Interest rate:</strong> {{ loan.loan_information.interest }}%</p>
            <p><strong>Issue Date:</strong> {{ loan.loan_information.start_date }}</p>
            <p><strong>Maturity Date:</strong> {{ loan.loan_information.end_date }}</p>
            <p><strong>Repayment Method:</strong> {{ loan.loan_information.method|title }}</p>
            <p><strong>Payment Duration:</strong> {{ loan.loan_information.months_tenure }} Months</p>
            <p><strong>Total Payable AMT:</strong> K{{ "{:,.0f}".format(loan.loan_information.total_payable) }}</p>
            <p><strong>Organisation:</strong> {{ loan.organisation_information.name }}</p>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-header">Supporting Documents</div>
              <div class="card-body">
                  {% set has_documents = false %}

                  {% if loan.loan_files.loan_agreement %}
                    {% set has_documents = true %}
                    <p><strong>Loan Agreement:</strong>
                      <a href="{{ loan.loan_files.loan_agreement }}"
                       target="_blank"
                       style="text-decoration: none; border: 1px solid #ccc; background-color: #f0f0f0; padding: 5px 10px; border-radius: 4px; display: inline-block;">
                       View
                    </a>

                    </p>
                  {% endif %}

                  {% if loan.loan_files.payment_schedule %}
                  {% set has_documents = true %}
                  <p><strong>Payment Schedule:</strong>
                    <a href="{{ loan.loan_files.payment_schedule }}"
                       target="_blank"
                       style="text-decoration: none; border: 1px solid #ccc; background-color: #f0f0f0; padding: 5px 10px; border-radius: 4px; display: inline-block;">
                       View
                    </a>
                  </p>
                {% endif %}

                  {# If you have additional files later in borrower_files or other documents, loop over them here #}
                  {% if not has_documents %}
                    <p>No documents available</p>
                  {% endif %}
                </div>

        </div>
      </div>
    </div>

    <div class="table-container">
      <h3>Loan Repayment Schedule</h3>
      {% if schedule %}
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead>
              <tr>
                {% for header in headers_info %}
                  <th>{{ header }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in schedule %}
                <tr>
                  {% for header in headers_info %}
                    <td>{{ row[header] if row[header] is not none else '' }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info">No payment schedule available for this loan.</div>
      {% endif %}
    </div>
  {% endif %}
</div>

{% endblock %}